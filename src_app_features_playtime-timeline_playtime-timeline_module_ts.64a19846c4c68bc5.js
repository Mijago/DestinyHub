"use strict";(self.webpackChunkD2Hub=self.webpackChunkD2Hub||[]).push([["src_app_features_playtime-timeline_playtime-timeline_module_ts"],{2235:(z,x,a)=>{a.r(x),a.d(x,{PlaytimeTimelineModule:()=>$});var S=a(6895),A=a(3797),T=a(1184),b=a(5861),M=a(7579),P=a(2722),D=a(8505),R=a(3103),H=a(3905),s=a(4650),F=a(6625),j=a(7185),g=a(1576),I=a(3546),O=a(1731),B=a(6074),C=a(2054);let G=(()=>{class i{constructor(e){this.theme=e,this.activities=[],this.hours=["12am","1am","2am","3am","4am","5am","6am","7am","8am","9am","10am","11am","12pm","1pm","2pm","3pm","4pm","5pm","6pm","7pm","8pm","9pm","10pm","11pm"],this.days=["Saturday","Friday","Thursday","Wednesday","Tuesday","Monday","Sunday"],this.overwrite={series:{}},this.chartOption={visualMap:{color:this.getColorArray(),min:0,max:1,calculable:!0,orient:"vertical",left:"0",top:"center",show:!1},grid:{top:0,bottom:0,right:0,left:0,containLabel:!0},xAxis:{type:"category",data:this.hours,splitArea:{show:!0}},yAxis:{type:"category",data:this.days,splitArea:{show:!0}},series:{name:"Days with activities played",type:"heatmap",data:[],label:{show:!0},animation:!1,emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}}}ngOnInit(){this.theme.theme.subscribe(e=>{this.overwrite=Object.assign({},this.overwrite,{visualMap:{color:this.getColorArray()}})})}ngOnChanges(e){this.updateActivities(this.activities)}updateActivities(e){const t={},r=new Set;for(const n of e){const o=new Date(Date.parse(n.period)),c=o.getMinutes(),m=o.getSeconds();o.setMinutes(0,0,0);const d=Math.ceil(n.values.activityDurationSeconds.basic.value+60*c+m)/60/60;for(let v=0;v<d;v++){const u=new Date(+o+60*v*60*1e3),y=u.getFullYear()+"-"+u.getMonth()+"-"+u.getDate()+"-"+u.getHours(),f=6-u.getDay();r.has(y)||(r.add(y),t[f]||(t[f]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),t[f][u.getHours()]++)}}let h=0,p=[];for(let n=0;n<7;n++)if(t[n])for(let o=0;o<24;o++){const c=t[n][o];c>0&&(p.push([o,n,c]),c>h&&(h=c))}this.overwrite={visualMap:{color:this.getColorArray(),max:h},series:{data:p}}}getColorArray(){switch(this.theme.currentTheme){case"theme-titan":return["#703636","#d95858"];case"theme-warlock":return["#9a7b39","#e0ca3b"];case"theme-hunter":return["#3a3d67","#4982ce"]}}}return i.\u0275fac=function(e){return new(e||i)(s.Y36(B.f))},i.\u0275cmp=s.Xpm({type:i,selectors:[["app-hour-playtime-heatmap-report"]],inputs:{activities:"activities"},features:[s.TTD],decls:1,vars:2,consts:[["echarts","",1,"demo-chart",3,"options","merge"]],template:function(e,t){1&e&&s._UZ(0,"div",0),2&e&&s.Q6J("options",t.chartOption)("merge",t.overwrite)},dependencies:[C._w],styles:[".demo-chart[_ngcontent-%COMP%]{height:300px}"]}),i})();const Z=[{path:"",component:T.$,children:[{path:"",component:(()=>{class i{constructor(e,t,r){this.guardianApi=e,this.toastr=t,this.changeRef=r,this.selectedGuardian=null,this.characters=[],this.totalActivityCount=0,this.activities=[],this.abortSubject=new M.x}ngOnInit(){this.abortSubject.subscribe(()=>{this.activities=[]})}ngOnDestroy(){this.abortSubject.next(null)}selectGuardian(e){var t=this;return(0,b.Z)(function*(){if(t.selectedGuardian=e,t.activities=[],t.abortSubject.next(null),null==e)return;var r=!1;t.abortSubject.subscribe(()=>r=!0);var h=t.toastr.info("Fetching Characters","Loading Data",{progressBar:!0,progressAnimation:"increasing",closeButton:!1,tapToDismiss:!1}),p=yield t.guardianApi.getAllCharacterHistoricalStats(e.membershipType,e.membershipId);if(r)return;t.characters=p,t.totalActivityCount=p.reduce((m,d)=>m+d.merged.allTime.activitiesEntered.basic.value,0),t.toastr.remove(h.toastId);var n=t.toastr.info("Loading Activities","Loading Activities",{progressBar:!0,progressAnimation:"increasing",disableTimeOut:!0,tapToDismiss:!1});let o=[];for(let m=0;m<t.characters.length&&!r;m++){const d=t.characters[m],v=`Characters: ${m+1} of ${t.characters.length}<br/>`,u=t.guardianApi.getCharacterActivities(e.membershipType,e.membershipId,d.characterId,t.abortSubject).pipe((0,P.R)(t.abortSubject),(0,D.b)(y=>{r||(t.activities=o.concat(y),n.toastRef.componentInstance.message=v+`<div>Activities: ${y.length} of ${d.merged.allTime.activitiesEntered.basic.value}</div>`)}),(0,R.Z)());var c=yield(0,H.z)(u);if(r)break;o=o.concat(c),t.activities=o}t.toastr.remove(n.toastId)})()}}return i.\u0275fac=function(e){return new(e||i)(s.Y36(F.J),s.Y36(j._W),s.Y36(s.sBO))},i.\u0275cmp=s.Xpm({type:i,selectors:[["app-playtime-report"]],decls:9,vars:2,consts:[["fxLayout","row","fxLayoutAlign","center none",1,"container"],["fxFlex","95%"],["fxFlex","100%","fxFlex.gt-lg","100%","fxFlex.sm","100%","fxFlex.xs","100%"],[3,"enableLoggedInUser","onGuardianSelection"],[3,"activities"]],template:function(e,t){1&e&&(s.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-card")(4,"app-guardian-selection",3),s.NdJ("onGuardianSelection",function(h){return t.selectGuardian(h)}),s.qZA()()()()(),s.TgZ(5,"div",0)(6,"div",1)(7,"mat-card"),s._UZ(8,"app-hour-playtime-heatmap-report",4),s.qZA()()()),2&e&&(s.xp6(4),s.Q6J("enableLoggedInUser",!0),s.xp6(4),s.Q6J("activities",t.activities))},dependencies:[g.xw,g.Wh,g.yH,I.a8,O.Q,G],styles:[".demo-chart[_ngcontent-%COMP%]{height:400px;width:100%}"]}),i})()}]}];let J=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=s.oAB({type:i}),i.\u0275inj=s.cJS({imports:[A.Bz.forChild(Z),A.Bz]}),i})();var w=a(5823),U=a(4466),Y=a(5112);let $=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=s.oAB({type:i}),i.\u0275inj=s.cJS({imports:[S.ez,U.m,Y.S,J,w.o9,C.Ns.forRoot({echarts:()=>a.e("default-node_modules_echarts_index_js").then(a.bind(a,4734))})]}),i})()}}]);