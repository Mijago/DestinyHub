"use strict";(self.webpackChunkD2Hub=self.webpackChunkD2Hub||[]).push([["src_app_features_trials-data-report_trials-data-report_module_ts"],{3540:(ae,U,c)=>{c.r(U),c.d(U,{TrialsDataReportModule:()=>te});var O=c(6895),R=c(3797),F=c(1184),C=c(5861),A=c(3905),W=c(7009),e=c(4650);let P=(()=>{class a{constructor(t){this.data=t}ngOnInit(){}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(W.qD))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-progress-toast"]],decls:1,vars:1,template:function(t,r){1&t&&e._uU(0),2&t&&e.hij("",r.data,"\n")}}),a})();var v=c(7340),J=c(529);let L=(()=>{class a{constructor(t){this.http=t}getApiData(t){return this.http.get("https://api.trialsofthenine.com/weeks/"+t)}getMostRecent(){return this.getApiData(0)}}return a.\u0275fac=function(t){return new(t||a)(e.LFG(J.eN))},a.\u0275prov=e.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var M=c(7392),b=c(3546),S=c(1576),k=c(2054);let I=(()=>{class a{constructor(){this.subclassData=[],this.chartOption={tooltip:{trigger:"item",confine:!0,formatter:t=>{let r=t.data;var l=(100*r.percent).toFixed(1);return isNaN(r.percent)?`Total: ${r.value.toLocaleString()}`:`${r.name}: ${r.value.toLocaleString()} (${l}%)`}},title:{},series:[{data:[],type:"sunburst",center:["48%","55%"],radius:[0,"90%"],label:{rotate:"radial"}}]}}isHunter(t){return["Gunslinger","Revenant","Arcstrider","Nightstalker"].indexOf(t.name)>-1}isWarlock(t){return["Dawnblade","Shadebinder","Stormcaller","Voidwalker"].indexOf(t.name)>-1}isTitan(t){return["Sunbreaker","Behemoth","Striker","Sentinel"].indexOf(t.name)>-1}ngOnChanges(t){var r=this.subclassData.filter(o=>this.isHunter(o)),l=this.subclassData.filter(o=>this.isWarlock(o)),u=this.subclassData.filter(o=>this.isTitan(o)),i=r.reduce((o,m)=>o+m.amount,0),p=l.reduce((o,m)=>o+m.amount,0),g=u.reduce((o,m)=>o+m.amount,0),f=i+g+p;this.chartOption.series[0].data=[{name:"Hunter",children:r.map(o=>({name:o.name,value:o.amount,itemStyle:{color:"#77afc0"},percent:o.amount/i})),itemStyle:{color:"#5f9cbb"},percent:i/f},{name:"Warlock",children:l.map(o=>({name:o.name,value:o.amount,itemStyle:{color:"#bdb177"},percent:o.amount/p})),itemStyle:{color:"#d7c16e"},percent:p/f},{name:"Titan",children:u.map(o=>({name:o.name,value:o.amount,itemStyle:{color:"#bd7777"},percent:o.amount/g})),itemStyle:{color:"#b76262"},percent:g/f}]}ngOnInit(){}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-class-and-subclass-chart"]],inputs:{subclassData:"subclassData"},features:[e.TTD],decls:1,vars:1,consts:[["echarts","",1,"demo-chart",3,"options"]],template:function(t,r){1&t&&e._UZ(0,"div",0),2&t&&e.Q6J("options",r.chartOption)},dependencies:[k._w]}),a})(),Q=(()=>{class a{constructor(){this.weeks=[],this.overwrite={series:[{},{},{}]},this.chartOption={tooltip:{trigger:"axis",confine:!0},legend:{type:"scroll",textStyle:{color:"white"},show:!0},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"time",boundaryGap:!1}],yAxis:[{alignTicks:!0,type:"value",max:100,min:0}],series:[{name:"Hunter",type:"line",stack:"Total",color:"#5f9cbb",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:"Titan",type:"line",stack:"Total",color:"#b76262",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:"Warlock",type:"line",stack:"Total",color:"#b6b45c",areaStyle:{},emphasis:{focus:"series"},data:[]}]}}isHunter(t){return["Gunslinger","Revenant","Arcstrider","Nightstalker"].indexOf(t.name)>-1}isWarlock(t){return["Dawnblade","Shadebinder","Stormcaller","Voidwalker"].indexOf(t.name)>-1}isTitan(t){return["Sunbreaker","Behemoth","Striker","Sentinel"].indexOf(t.name)>-1}ngOnInit(){}ngOnChanges(t){if(0!=this.weeks.length){var r=[],l=[],u=[];for(let x of this.weeks){var i=new Date(Date.parse(x.startDate)),p=[i.getFullYear(),i.getMonth()+1,i.getDate()].join("/"),g=x.subclass.filter(h=>this.isHunter(h)),f=x.subclass.filter(h=>this.isWarlock(h)),o=x.subclass.filter(h=>this.isTitan(h)),m=g.reduce((h,n)=>h+n.amount,0),T=f.reduce((h,n)=>h+n.amount,0),w=o.reduce((h,n)=>h+n.amount,0),y=m+T+w;0!=y&&(r.push([p,(m/y*100).toFixed(2)]),l.push([p,(w/y*100).toFixed(2)]),u.push([p,(T/y*100).toFixed(2)]))}this.overwrite.series[0].data=r,this.overwrite.series[1].data=l,this.overwrite.series[2].data=u,this.overwrite=Object.assign({},this.overwrite)}}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-class-and-subclass-timeline-chart"]],inputs:{weeks:"weeks"},features:[e.TTD],decls:1,vars:2,consts:[["echarts","",1,"demo-chart",3,"options","merge"]],template:function(t,r){1&t&&e._UZ(0,"div",0),2&t&&e.Q6J("options",r.chartOption)("merge",r.overwrite)},dependencies:[k._w]}),a})();c(4734);let H=(()=>{class a{constructor(){this.weeks=[],this.overwrite={},this.chartOption={tooltip:{trigger:"axis"},legend:{textStyle:{color:"white"},show:!0,type:"scroll"},grid:{left:"3%",right:"4%",bottom:"12%",top:"12%",containLabel:!0},xAxis:[{type:"time",boundaryGap:!1}],darkMode:!0,dataZoom:[{type:"inside"},{type:"slider"}],yAxis:[{alignTicks:!0,boundaryGap:!1,type:"value",max:100,min:0}],series:[]}}ngOnInit(){}ngOnChanges(t){if(0!=this.weeks.length){var r={};for(let f of this.weeks){var l=f.platforms[0].weaponTypes.reduce((o,m)=>o+m.kills,0);for(let o of f.platforms[0].weaponTypes){null==r[o.weaponType]&&(r[o.weaponType]={name:o.weaponType,type:"line",smooth:!0,stack:"Total",areaStyle:{},emphasis:{focus:"series",blurScope:"coordinateSystem"},data:[]});var u=new Date(Date.parse(f.startDate)),i=[u.getFullYear(),u.getMonth()+1,u.getDate()].join("/");let m=+(o.kills/l*100).toFixed(2);r[o.weaponType].data.push([i,m])}}var p=new Date(Date.parse(this.weeks[10].startDate)-36e3),g=[p.getFullYear(),p.getMonth()+1,p.getDate()].join("/");this.overwrite={dataZoom:[{startValue:g}],series:Object.values(r)}}}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-weapon-usage-chart"]],inputs:{weeks:"weeks"},features:[e.TTD],decls:1,vars:2,consts:[["echarts","",1,"demo-chart",3,"options","merge"]],template:function(t,r){1&t&&e._UZ(0,"div",0),2&t&&e.Q6J("options",r.chartOption)("merge",r.overwrite)},dependencies:[k._w],styles:[".demo-chart[_ngcontent-%COMP%]{height:450px}"]}),a})();var N=c(6489),j=c(1109);let $=(()=>{class a{constructor(t){this.manifest=t,this.overwrite={series:[{}]},this.chartOption={title:{},tooltip:{trigger:"item",confine:!0,formatter:r=>{let l=r.data;var u=(100*l.percent).toFixed(1);return isNaN(l.percent)?`Total: ${l.value.toLocaleString()}`:`${l.name}: ${l.value.toLocaleString()} (${u}%)`}},series:[{data:[],type:"sunburst",center:["48%","55%"],labelLayout:{hideOverlap:!0},label:{overflow:"truncate",rotate:"radial"},levels:[{},{radius:[0,"30%"]},{radius:["30%","90%"]}]}]}}ngOnInit(){}ngOnChanges(t){var r=this;return(0,C.Z)(function*(){yield(0,A.z)(r.manifest.ensureManifestTableExists("DestinyInventoryItemDefinition"));var u=r.week.armor.map(function(){var n=(0,C.Z)(function*(d){return{armor:d,cls:(yield N.s.DestinyInventoryItemDefinition.where("hash").equals(Number.parseInt(d.hash)).first())?.classType}});return function(d){return n.apply(this,arguments)}}()),i=yield Promise.all(u),g=i.filter(n=>0==n.cls).sort((n,d)=>d.armor.amount-n.armor.amount),f=i.filter(n=>2==n.cls).sort((n,d)=>d.armor.amount-n.armor.amount),o=i.filter(n=>1==n.cls).sort((n,d)=>d.armor.amount-n.armor.amount),m=o.reduce((n,d)=>n+d.armor.amount,0),T=f.reduce((n,d)=>n+d.armor.amount,0),w=g.reduce((n,d)=>n+d.armor.amount,0),y=m+w+T,x=(n,d)=>n.reduce((D,Z)=>(D.count/d>.8?D.data[0].armor.amount+=Z.armor.amount:(D.data.push(Z),D.count+=Z.armor.amount),D),{data:[{cls:void 0,armor:{amount:0,name:"Others"}}],count:0}).data;o=x(o,m),f=x(f,T),g=x(g,w);var h=[{name:"Hunter",children:o.map(n=>({name:n.armor.name,value:n.armor.amount,itemStyle:{color:"#77afc0"},percent:n.armor.amount/m})),itemStyle:{color:"#5f9cbb"},percent:m/y},{name:"Warlock",children:f.map(n=>({name:n.armor.name,value:n.armor.amount,itemStyle:{color:"#bdb177"},percent:n.armor.amount/T})),itemStyle:{color:"#d7c16e"},percent:T/y},{name:"Titan",children:g.map(n=>({name:n.armor.name,value:n.armor.amount,itemStyle:{color:"#bd7777"},percent:n.armor.amount/w})),itemStyle:{color:"#b76262"},percent:w/y}];r.overwrite={series:[{data:h}]}})()}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(j.W))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-exotic-armor-usage-pie-chart"]],inputs:{week:"week"},features:[e.TTD],decls:1,vars:2,consts:[["echarts","",1,"demo-chart",3,"options","merge"]],template:function(t,r){1&t&&e._UZ(0,"div",0),2&t&&e.Q6J("options",r.chartOption)("merge",r.overwrite)},dependencies:[k._w]}),a})(),Y=(()=>{class a{constructor(){this.week=null,this.overwrite={},this.chartOption={tooltip:{trigger:"item",confine:!0,formatter:t=>{let r=t.data;var l=(100*r.percent).toFixed(1);return`${r.name}: ${r.value.toLocaleString()} (${l}%)`}},series:{data:[],type:"pie",radius:[0,"100%"],labelLayout:{hideOverlap:!0},label:{position:"inside",overflow:"truncate",rotate:"radial"}}}}ngOnInit(){}ngOnChanges(t){var r=this;return(0,C.Z)(function*(){if(r.week){var l=r.week.platforms[0].weaponTypes.reduce((i,p)=>i+p.kills,0),u=r.week.platforms[0].weaponTypes.map(i=>({name:i.weaponType,value:i.kills,percent:i.kills/l,precisionRatio:i.headshots/i.kills})).sort((i,p)=>p.value-i.value);console.log("data",u),r.overwrite={series:{data:u}}}else r.overwrite={}})()}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-weapon-usage-pie-chart"]],inputs:{week:"week"},features:[e.TTD],decls:1,vars:2,consts:[["echarts","",1,"demo-chart",3,"options","merge"]],template:function(t,r){1&t&&e._UZ(0,"div",0),2&t&&e.Q6J("options",r.chartOption)("merge",r.overwrite)},dependencies:[k._w]}),a})();function B(a,s){1&a&&(e.TgZ(0,"div",0)(1,"div",5)(2,"mat-icon"),e._uU(3,"dashboard"),e.qZA(),e.TgZ(4,"p"),e._uU(5,"Loading trials information..."),e.qZA()(),e._UZ(6,"mat-icon"),e.qZA())}function G(a,s){if(1&a&&(e.TgZ(0,"div",6)(1,"div",7)(2,"mat-card")(3,"mat-card-title-group")(4,"mat-card-title"),e._uU(5," Trials Subclass usage "),e.qZA(),e.TgZ(6,"mat-card-subtitle"),e._uU(7),e.qZA()(),e._UZ(8,"app-class-and-subclass-chart",8),e.qZA()(),e.TgZ(9,"div",7)(10,"mat-card")(11,"mat-card-title-group")(12,"mat-card-title"),e._uU(13," Trials Exotic armor Usage "),e.qZA(),e.TgZ(14,"mat-card-subtitle"),e._uU(15),e.qZA()(),e._UZ(16,"app-exotic-armor-usage-pie-chart",9),e.qZA()()()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("@fade",void 0),e.xp6(6),e.hij(" Week ",t.week," "),e.xp6(1),e.Q6J("subclassData",t.trialsReportData.subclass),e.xp6(1),e.Q6J("@fade",void 0),e.xp6(6),e.hij(" Week ",t.week," "),e.xp6(1),e.Q6J("week",t.trialsReportData)}}function z(a,s){if(1&a&&(e.TgZ(0,"div",10)(1,"div",7)(2,"mat-card")(3,"mat-card-title-group")(4,"mat-card-title"),e._uU(5," Trials Class distribution over time "),e.qZA(),e.TgZ(6,"mat-card-subtitle"),e._uU(7),e.qZA()(),e._UZ(8,"app-class-and-subclass-timeline-chart",11),e.qZA()(),e.TgZ(9,"div",7)(10,"mat-card")(11,"mat-card-title-group")(12,"mat-card-title"),e._uU(13," Trials Weapon Type Usage "),e.qZA(),e.TgZ(14,"mat-card-subtitle"),e._uU(15),e.qZA()(),e._UZ(16,"app-weapon-usage-pie-chart",9),e.qZA()()()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("@fade",void 0)("@fade",void 0),e.xp6(6),e.hij(" Weeks 114 to ",t.week," "),e.xp6(1),e.Q6J("weeks",t.previousWeeks),e.xp6(1),e.Q6J("@fade",void 0),e.xp6(6),e.hij(" Week ",t.week," "),e.xp6(1),e.Q6J("week",t.trialsReportData)}}function X(a,s){if(1&a&&(e.TgZ(0,"div",10)(1,"div",12)(2,"mat-card")(3,"mat-card-title-group")(4,"mat-card-title"),e._uU(5," Trials Weapon Type usage over time "),e.qZA(),e.TgZ(6,"mat-card-subtitle"),e._uU(7),e.qZA()(),e._UZ(8,"app-weapon-usage-chart",11),e.qZA()()()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("@fade",void 0),e.xp6(6),e.hij(" Weeks 1 to ",t.week," "),e.xp6(1),e.Q6J("weeks",t.previousWeeks)}}function E(a,s){1&a&&(e.TgZ(0,"div",10)(1,"div",12)(2,"mat-card")(3,"mat-card-title-group")(4,"mat-card-title"),e._uU(5,"Trials Statistics"),e.qZA(),e.TgZ(6,"mat-card-subtitle"),e._uU(7," Data provided by "),e.TgZ(8,"a",13),e._uU(9,"Trials.Report"),e.qZA(),e._uU(10,". "),e.qZA()()()()())}const q=[{path:"",component:F.$,children:[{path:"",component:(()=>{class a{constructor(t,r){this.trialsReportApi=t,this._snackBar=r,this.updateStatus={isUpdating:!1,weeksToUpdate:0,updatingWeek:0},this.week=-1,this.previousWeeks=[],this.trialsReportData=void 0}ngOnInit(){var t=this;return(0,C.Z)(function*(){t.trialsReportData=yield(0,A.z)(t.trialsReportApi.getMostRecent()),console.log(t.trialsReportData),t.week=t.trialsReportData.weekNumber;var r=t._snackBar.openFromComponent(P,{data:"",horizontalPosition:"right",verticalPosition:"top"});t.updateStatus.weeksToUpdate=t.week-1,t.updateStatus.updatingWeek=0,t.updateStatus.isUpdating=!0;var l=[];for(let i=t.week-1;i>=1;i--)l.push(t.getWeek(i).then(p=>(t.updateStatus.updatingWeek++,r.instance.data=`Fetching Trials data (${t.updateStatus.updatingWeek} of ${t.updateStatus.weeksToUpdate})`,p)));var u=yield Promise.all(l);t.updateStatus.isUpdating=!1,r.dismiss(),t.previousWeeks=[t.trialsReportData].concat(u)})()}getWeek(t){var r=this;return(0,C.Z)(function*(){let l="trialsreport-week-"+t;var u=localStorage.getItem(l);if(null!=u)return JSON.parse(u);var i=yield(0,A.z)(r.trialsReportApi.getApiData(t));return localStorage.setItem(l,JSON.stringify(i)),i})()}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(L),e.Y36(W.ux))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-trials-data-report"]],decls:7,vars:5,consts:[["fxLayout","row","fxLayoutAlign","center none",1,"container"],["fxFlex","95%"],["class","container","fxLayout","row","fxLayoutAlign","center none",4,"ngIf"],["class","container","fxLayout","row","fxLayout.sm","column","fxLayout.xs","column","fxLayoutAlign","center none","fxLayoutGap","15px",4,"ngIf"],["class","container","fxLayout","row","fxLayout.sm","column","fxLayout.xs","column","fxLayoutAlign","center none","fxLayoutGap","5px",4,"ngIf"],["fxFlex","50%",1,"text-center","no-records","animate"],["fxLayout","row","fxLayout.sm","column","fxLayout.xs","column","fxLayoutAlign","center none","fxLayoutGap","15px",1,"container"],["fxFlex","50%","fxFlex.gt-lg","50%","fxFlex.sm","100%","fxFlex.xs","100%"],["mat-card-image","",3,"subclassData"],[3,"week"],["fxLayout","row","fxLayout.sm","column","fxLayout.xs","column","fxLayoutAlign","center none","fxLayoutGap","5px",1,"container"],[3,"weeks"],["fxFlex","100%","fxFlex.gt-lg","100%","fxFlex.sm","100%","fxFlex.xs","100%"],["href","https://trials.report",1,"accent-color"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,B,7,0,"div",2),e.YNc(3,G,17,6,"div",3),e.YNc(4,z,17,7,"div",4),e.YNc(5,X,9,3,"div",4),e.YNc(6,E,11,0,"div",4),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("ngIf",-1==r.week),e.xp6(1),e.Q6J("ngIf",r.trialsReportData),e.xp6(1),e.Q6J("ngIf",r.trialsReportData),e.xp6(1),e.Q6J("ngIf",r.trialsReportData),e.xp6(1),e.Q6J("ngIf",r.trialsReportData))},dependencies:[O.O5,M.Hw,b.a8,b.C1,b.n5,b.$j,b.G2,S.xw,S.SQ,S.Wh,S.yH,I,Q,H,$,Y],styles:[".theme-titan[_ngcontent-%COMP%]   .pageHeader[_ngcontent-%COMP%]{background-color:#d32f2f}  .theme-titan .pageHeader{background-color:#d32f2f}.theme-warlock[_ngcontent-%COMP%]   .pageHeader[_ngcontent-%COMP%]{background-color:#ffa000}  .theme-warlock .pageHeader{background-color:#ffa000}.theme-hunter[_ngcontent-%COMP%]   .pageHeader[_ngcontent-%COMP%]{background-color:#1976d2}  .theme-hunter .pageHeader{background-color:#1976d2}mat-card[_ngcontent-%COMP%]{margin-bottom:5px}.container1[_ngcontent-%COMP%]{font-size:16px;font-family:Roboto,Helvetica Neue,sans-serif}.chart-container[_ngcontent-%COMP%]{border-radius:5px;border:1px solid rgba(255,255,255,.2)}"],data:{animation:[(0,v.X$)("fade",[(0,v.eR)(":enter",[(0,v.oB)({opacity:0}),(0,v.jt)(300,(0,v.oB)({opacity:1}))]),(0,v.eR)(":leave",[(0,v.oB)({opacity:1}),(0,v.jt)(300,(0,v.oB)({opacity:0}))])])]}}),a})()}]}];let K=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[R.Bz.forChild(q),R.Bz]}),a})();var _=c(5823),ee=c(5112);let te=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({providers:[L],imports:[O.ez,ee.S,K,_.o9,k.Ns.forRoot({echarts:()=>Promise.resolve().then(c.bind(c,4734))})]}),a})()}}]);