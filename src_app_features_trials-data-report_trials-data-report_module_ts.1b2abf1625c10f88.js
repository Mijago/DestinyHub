"use strict";(self.webpackChunkD2Hub=self.webpackChunkD2Hub||[]).push([["src_app_features_trials-data-report_trials-data-report_module_ts"],{9957:(et,U,i)=>{i.r(U),i.d(U,{TrialsDataReportModule:()=>tt});var O=i(6895),L=i(3797),I=i(1184),b=i(5861),A=i(3905),Z=i(7009),t=i(4650);let P=(()=>{class a{constructor(e){this.data=e}ngOnInit(){}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(Z.qD))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-progress-toast"]],decls:1,vars:1,template:function(e,r){1&e&&t._uU(0),2&e&&t.hij("",r.data,"\n")}}),a})();var v=i(7340),J=i(529);let F=(()=>{class a{constructor(e){this.http=e}getApiData(e){return this.http.get("https://api.trialsofthenine.com/weeks/"+e)}getMostRecent(){return this.getApiData(0)}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(J.eN))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var k=i(3546),S=i(1576),W=i(7392),D=i(2054);let Q=(()=>{class a{constructor(){this.subclassData=[],this.chartOption={tooltip:{trigger:"item",confine:!0,formatter:e=>{let r=e.data;var l=(100*r.percent).toFixed(1);return isNaN(r.percent)?`Total: ${r.value.toLocaleString()}`:`${r.name}: ${r.value.toLocaleString()} (${l}%)`}},series:[{data:[],type:"sunburst",radius:[0,"100%"],label:{rotate:"radial"}}]}}isHunter(e){return["Gunslinger","Revenant","Arcstrider","Nightstalker"].indexOf(e.name)>-1}isWarlock(e){return["Dawnblade","Shadebinder","Stormcaller","Voidwalker"].indexOf(e.name)>-1}isTitan(e){return["Sunbreaker","Behemoth","Striker","Sentinel"].indexOf(e.name)>-1}ngOnChanges(e){var r=this.subclassData.filter(n=>this.isHunter(n)),l=this.subclassData.filter(n=>this.isWarlock(n)),u=this.subclassData.filter(n=>this.isTitan(n)),c=r.reduce((n,p)=>n+p.amount,0),d=l.reduce((n,p)=>n+p.amount,0),g=u.reduce((n,p)=>n+p.amount,0),h=c+g+d;this.chartOption.series[0].data=[{name:"Hunter",children:r.map(n=>({name:n.name,value:n.amount,itemStyle:{color:"#77afc0"},percent:n.amount/c})),itemStyle:{color:"#5f9cbb"},percent:c/h},{name:"Warlock",children:l.map(n=>({name:n.name,value:n.amount,itemStyle:{color:"#bdb177"},percent:n.amount/d})),itemStyle:{color:"#d7c16e"},percent:d/h},{name:"Titan",children:u.map(n=>({name:n.name,value:n.amount,itemStyle:{color:"#bd7777"},percent:n.amount/g})),itemStyle:{color:"#b76262"},percent:g/h}]}ngOnInit(){}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-class-and-subclass-chart"]],inputs:{subclassData:"subclassData"},features:[t.TTD],decls:1,vars:1,consts:[["echarts","",1,"demo-chart",3,"options"]],template:function(e,r){1&e&&t._UZ(0,"div",0),2&e&&t.Q6J("options",r.chartOption)},dependencies:[D._w],styles:[".demo-chart[_ngcontent-%COMP%]{height:400px}"]}),a})(),M=(()=>{class a{constructor(){this.weeks=[],this.overwrite={series:[{},{},{}]},this.chartOption={tooltip:{trigger:"axis",confine:!0},legend:{type:"scroll",textStyle:{color:"white"},show:!0},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"time",boundaryGap:!1}],yAxis:[{alignTicks:!0,type:"value",max:100,min:0}],series:[{name:"Hunter",type:"line",stack:"Total",color:"#5f9cbb",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:"Titan",type:"line",stack:"Total",color:"#b76262",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:"Warlock",type:"line",stack:"Total",color:"#b6b45c",areaStyle:{},emphasis:{focus:"series"},data:[]}]}}isHunter(e){return["Gunslinger","Revenant","Arcstrider","Nightstalker"].indexOf(e.name)>-1}isWarlock(e){return["Dawnblade","Shadebinder","Stormcaller","Voidwalker"].indexOf(e.name)>-1}isTitan(e){return["Sunbreaker","Behemoth","Striker","Sentinel"].indexOf(e.name)>-1}ngOnInit(){}ngOnChanges(e){if(0!=this.weeks.length){var r=[],l=[],u=[];for(let x of this.weeks){var c=new Date(Date.parse(x.startDate)),d=[c.getFullYear(),c.getMonth()+1,c.getDate()].join("/"),g=x.subclass.filter(f=>this.isHunter(f)),h=x.subclass.filter(f=>this.isWarlock(f)),n=x.subclass.filter(f=>this.isTitan(f)),p=g.reduce((f,o)=>f+o.amount,0),T=h.reduce((f,o)=>f+o.amount,0),w=n.reduce((f,o)=>f+o.amount,0),y=p+T+w;0!=y&&(r.push([d,(p/y*100).toFixed(2)]),l.push([d,(w/y*100).toFixed(2)]),u.push([d,(T/y*100).toFixed(2)]))}this.overwrite.series[0].data=r,this.overwrite.series[1].data=l,this.overwrite.series[2].data=u,this.overwrite=Object.assign({},this.overwrite)}}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-class-and-subclass-timeline-chart"]],inputs:{weeks:"weeks"},features:[t.TTD],decls:1,vars:2,consts:[["echarts","",1,"demo-chart",3,"options","merge"]],template:function(e,r){1&e&&t._UZ(0,"div",0),2&e&&t.Q6J("options",r.chartOption)("merge",r.overwrite)},dependencies:[D._w]}),a})();i(4734);let N=(()=>{class a{constructor(){this.weeks=[],this.overwrite={},this.chartOption={tooltip:{trigger:"axis"},legend:{textStyle:{color:"white"},show:!0,type:"scroll"},grid:{left:"3%",right:"4%",bottom:"12%",top:"12%",containLabel:!0},xAxis:[{type:"time",boundaryGap:!1}],darkMode:!0,dataZoom:[{type:"inside"},{type:"slider"}],yAxis:[{alignTicks:!0,boundaryGap:!1,type:"value",max:100,min:0}],series:[]}}ngOnInit(){}ngOnChanges(e){if(0!=this.weeks.length){var r={};for(let h of this.weeks){var l=h.platforms[0].weaponTypes.reduce((n,p)=>n+p.kills,0);for(let n of h.platforms[0].weaponTypes){null==r[n.weaponType]&&(r[n.weaponType]={name:n.weaponType,type:"line",smooth:!0,stack:"Total",areaStyle:{},emphasis:{focus:"series",blurScope:"coordinateSystem"},data:[]});var u=new Date(Date.parse(h.startDate)),c=[u.getFullYear(),u.getMonth()+1,u.getDate()].join("/");let p=+(n.kills/l*100).toFixed(2);r[n.weaponType].data.push([c,p])}}var d=new Date(Date.parse(this.weeks[10].startDate)-36e3),g=[d.getFullYear(),d.getMonth()+1,d.getDate()].join("/");this.overwrite={dataZoom:[{startValue:g}],series:Object.values(r)}}}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-weapon-usage-chart"]],inputs:{weeks:"weeks"},features:[t.TTD],decls:1,vars:2,consts:[["echarts","",1,"demo-chart",3,"options","merge"]],template:function(e,r){1&e&&t._UZ(0,"div",0),2&e&&t.Q6J("options",r.chartOption)("merge",r.overwrite)},dependencies:[D._w],styles:[".demo-chart[_ngcontent-%COMP%]{height:450px}"]}),a})();var j=i(6489),Y=i(1109);let $=(()=>{class a{constructor(e){this.manifest=e,this.overwrite={series:[{}]},this.chartOption={tooltip:{trigger:"item",confine:!0,formatter:r=>{let l=r.data;var u=(100*l.percent).toFixed(1);return isNaN(l.percent)?`Total: ${l.value.toLocaleString()}`:`${l.name}: ${l.value.toLocaleString()} (${u}%)`}},series:[{data:[],type:"sunburst",radius:[0,"100%"],labelLayout:{hideOverlap:!0},label:{overflow:"truncate",rotate:"radial"},levels:[{},{radius:[0,"30%"]},{radius:["30%","100%"]}]}]}}ngOnInit(){}ngOnChanges(e){var r=this;return(0,b.Z)(function*(){yield(0,A.z)(r.manifest.ensureManifestTableExists("DestinyInventoryItemDefinition"));var u=r.week.armor.map(function(){var o=(0,b.Z)(function*(m){return{armor:m,cls:(yield j.s.DestinyInventoryItemDefinition.where("hash").equals(Number.parseInt(m.hash)).first())?.classType}});return function(m){return o.apply(this,arguments)}}()),c=yield Promise.all(u),g=c.filter(o=>0==o.cls).sort((o,m)=>m.armor.amount-o.armor.amount),h=c.filter(o=>2==o.cls).sort((o,m)=>m.armor.amount-o.armor.amount),n=c.filter(o=>1==o.cls).sort((o,m)=>m.armor.amount-o.armor.amount),p=n.reduce((o,m)=>o+m.armor.amount,0),T=h.reduce((o,m)=>o+m.armor.amount,0),w=g.reduce((o,m)=>o+m.armor.amount,0),y=p+w+T,x=(o,m)=>o.reduce((C,R)=>(C.count/m>.8?C.data[0].armor.amount+=R.armor.amount:(C.data.push(R),C.count+=R.armor.amount),C),{data:[{cls:void 0,armor:{amount:0,name:"Others"}}],count:0}).data;n=x(n,p),h=x(h,T),g=x(g,w);var f=[{name:"Hunter",children:n.map(o=>({name:o.armor.name,value:o.armor.amount,itemStyle:{color:"#77afc0"},percent:o.armor.amount/p})),itemStyle:{color:"#5f9cbb"},percent:p/y},{name:"Warlock",children:h.map(o=>({name:o.armor.name,value:o.armor.amount,itemStyle:{color:"#bdb177"},percent:o.armor.amount/T})),itemStyle:{color:"#d7c16e"},percent:T/y},{name:"Titan",children:g.map(o=>({name:o.armor.name,value:o.armor.amount,itemStyle:{color:"#bd7777"},percent:o.armor.amount/w})),itemStyle:{color:"#b76262"},percent:w/y}];r.overwrite={series:[{data:f}]}})()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(Y.W))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-exotic-armor-usage-pie-chart"]],inputs:{week:"week"},features:[t.TTD],decls:1,vars:2,consts:[["echarts","",1,"demo-chart",3,"options","merge"]],template:function(e,r){1&e&&t._UZ(0,"div",0),2&e&&t.Q6J("options",r.chartOption)("merge",r.overwrite)},dependencies:[D._w],styles:[".demo-chart[_ngcontent-%COMP%]{height:400px}"]}),a})();function B(a,s){1&a&&(t.TgZ(0,"div",0)(1,"div",5)(2,"mat-icon"),t._uU(3,"dashboard"),t.qZA(),t.TgZ(4,"p"),t._uU(5,"Loading trials information..."),t.qZA()(),t._UZ(6,"mat-icon"),t.qZA())}function G(a,s){if(1&a&&(t.TgZ(0,"div",6)(1,"div",7)(2,"mat-card")(3,"mat-card-title-group")(4,"mat-card-title"),t._uU(5," Trials Subclass usage "),t.qZA(),t.TgZ(6,"mat-card-subtitle"),t._uU(7),t.qZA()(),t._UZ(8,"app-class-and-subclass-chart",8),t.qZA()(),t.TgZ(9,"div",7)(10,"mat-card")(11,"mat-card-title-group")(12,"mat-card-title"),t._uU(13," Trials Exotic armor Usage "),t.qZA(),t.TgZ(14,"mat-card-subtitle"),t._uU(15),t.qZA()(),t._UZ(16,"app-exotic-armor-usage-pie-chart",9),t.qZA()()()),2&a){const e=t.oxw();t.xp6(1),t.Q6J("@fade",void 0),t.xp6(6),t.hij(" Week ",e.week," "),t.xp6(1),t.Q6J("subclassData",e.trialsReportData.subclass),t.xp6(1),t.Q6J("@fade",void 0),t.xp6(6),t.hij(" Week ",e.week," "),t.xp6(1),t.Q6J("week",e.trialsReportData)}}function H(a,s){if(1&a&&(t.TgZ(0,"div",10)(1,"div",11)(2,"mat-card")(3,"mat-card-title-group")(4,"mat-card-title"),t._uU(5," Trials Class distribution over time "),t.qZA(),t.TgZ(6,"mat-card-subtitle"),t._uU(7),t.qZA()(),t._UZ(8,"app-class-and-subclass-timeline-chart",12),t.qZA()()()),2&a){const e=t.oxw();t.xp6(1),t.Q6J("@fade",void 0),t.xp6(6),t.hij(" Weeks 114 to ",e.week," "),t.xp6(1),t.Q6J("weeks",e.previousWeeks)}}function z(a,s){if(1&a&&(t.TgZ(0,"div",10)(1,"div",11)(2,"mat-card")(3,"mat-card-title-group")(4,"mat-card-title"),t._uU(5," Trials Weapon Type usage over time "),t.qZA(),t.TgZ(6,"mat-card-subtitle"),t._uU(7),t.qZA()(),t._UZ(8,"app-weapon-usage-chart",12),t.qZA()()()),2&a){const e=t.oxw();t.xp6(1),t.Q6J("@fade",void 0),t.xp6(6),t.hij(" Weeks 1 to ",e.week," "),t.xp6(1),t.Q6J("weeks",e.previousWeeks)}}function X(a,s){1&a&&(t.TgZ(0,"div",10)(1,"div",11)(2,"mat-card")(3,"mat-card-title-group")(4,"mat-card-title"),t._uU(5,"Trials Statistics"),t.qZA(),t.TgZ(6,"mat-card-subtitle"),t._uU(7," Data provided by "),t.TgZ(8,"a",13),t._uU(9,"Trials.Report"),t.qZA(),t._uU(10,". "),t.qZA()()()()())}const V=[{path:"",component:I.$,children:[{path:"",component:(()=>{class a{constructor(e,r){this.trialsReportApi=e,this._snackBar=r,this.updateStatus={isUpdating:!1,weeksToUpdate:0,updatingWeek:0},this.week=-1,this.previousWeeks=[],this.trialsReportData=void 0}ngOnInit(){var e=this;return(0,b.Z)(function*(){e.trialsReportData=yield(0,A.z)(e.trialsReportApi.getMostRecent()),console.log(e.trialsReportData),e.week=e.trialsReportData.weekNumber;var r=e._snackBar.openFromComponent(P,{data:"",horizontalPosition:"right",verticalPosition:"top"});e.updateStatus.weeksToUpdate=e.week-1,e.updateStatus.updatingWeek=0,e.updateStatus.isUpdating=!0;var l=[];for(let c=e.week-1;c>=1;c--)l.push(e.getWeek(c).then(d=>(e.updateStatus.updatingWeek++,r.instance.data=`Fetching Trials data (${e.updateStatus.updatingWeek} of ${e.updateStatus.weeksToUpdate})`,d)));var u=yield Promise.all(l);e.updateStatus.isUpdating=!1,r.dismiss(),e.previousWeeks=[e.trialsReportData].concat(u)})()}getWeek(e){var r=this;return(0,b.Z)(function*(){let l="trialsreport-week-"+e;var u=localStorage.getItem(l);if(null!=u)return JSON.parse(u);var c=yield(0,A.z)(r.trialsReportApi.getApiData(e));return localStorage.setItem(l,JSON.stringify(c)),c})()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(F),t.Y36(Z.ux))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-trials-data-report"]],decls:7,vars:5,consts:[["fxLayout","row","fxLayoutAlign","center none",1,"container"],["fxFlex","95%"],["class","container","fxLayout","row","fxLayoutAlign","center none",4,"ngIf"],["class","container","fxLayout","row","fxLayout.sm","column","fxLayout.xs","column","fxLayoutAlign","center none","fxLayoutGap","15px",4,"ngIf"],["class","container","fxLayout","row","fxLayout.sm","column","fxLayout.xs","column","fxLayoutAlign","center none","fxLayoutGap","5px",4,"ngIf"],["fxFlex","50%",1,"text-center","no-records","animate"],["fxLayout","row","fxLayout.sm","column","fxLayout.xs","column","fxLayoutAlign","center none","fxLayoutGap","15px",1,"container"],["fxFlex","50%","fxFlex.gt-lg","50%","fxFlex.sm","95%","fxFlex.xs","95%"],["mat-card-image","",3,"subclassData"],[3,"week"],["fxLayout","row","fxLayout.sm","column","fxLayout.xs","column","fxLayoutAlign","center none","fxLayoutGap","5px",1,"container"],["fxFlex","100%","fxFlex.gt-lg","100%","fxFlex.sm","100%","fxFlex.xs","100%"],[3,"weeks"],["href","https://trials.report",1,"accent-color"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,B,7,0,"div",2),t.YNc(3,G,17,6,"div",3),t.YNc(4,H,9,3,"div",4),t.YNc(5,z,9,3,"div",4),t.YNc(6,X,11,0,"div",4),t.qZA()()),2&e&&(t.xp6(2),t.Q6J("ngIf",-1==r.week),t.xp6(1),t.Q6J("ngIf",r.trialsReportData),t.xp6(1),t.Q6J("ngIf",r.trialsReportData),t.xp6(1),t.Q6J("ngIf",r.trialsReportData),t.xp6(1),t.Q6J("ngIf",r.trialsReportData))},dependencies:[O.O5,k.a8,k.C1,k.n5,k.$j,k.G2,S.xw,S.SQ,S.Wh,S.yH,W.Hw,Q,M,N,$],styles:["mat-card[_ngcontent-%COMP%]{margin-bottom:5px}"],data:{animation:[(0,v.X$)("fade",[(0,v.eR)(":enter",[(0,v.oB)({opacity:0}),(0,v.jt)(300,(0,v.oB)({opacity:1}))]),(0,v.eR)(":leave",[(0,v.oB)({opacity:1}),(0,v.jt)(300,(0,v.oB)({opacity:0}))])])]}}),a})()}]}];let q=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[L.Bz.forChild(V),L.Bz]}),a})();var K=i(5823),_=i(3683);let tt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({providers:[F],imports:[O.ez,Z.ZX,q,k.QW,K.o9,W.Ps,D.Ns.forRoot({echarts:()=>Promise.resolve().then(i.bind(i,4734))}),_.g0]}),a})()}}]);