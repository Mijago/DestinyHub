"use strict";(self.webpackChunkD2Hub=self.webpackChunkD2Hub||[]).push([["src_app_features_playtime-timeline_playtime-timeline_module_ts"],{8221:($,C,s)=>{s.r(C),s.d(C,{PlaytimeTimelineModule:()=>Q});var S=s(6895),b=s(3797),T=s(1184),M=s(5861),P=s(7579),w=s(2722),D=s(8505),H=s(3103),R=s(3905),a=s(4650),O=s(6625),F=s(7185),g=s(1576),j=s(3546),I=s(1731),x=s(6074),f=s(2054);let Z=(()=>{class i{constructor(e){this.theme=e,this.activities=[],this.hours=["12am","1am","2am","3am","4am","5am","6am","7am","8am","9am","10am","11am","12pm","1pm","2pm","3pm","4pm","5pm","6pm","7pm","8pm","9pm","10pm","11pm"],this.days=["Saturday","Friday","Thursday","Wednesday","Tuesday","Monday","Sunday"],this.overwrite={series:{}},this.chartOption={visualMap:{color:this.getColorArray(),min:0,max:1,calculable:!0,orient:"vertical",left:"0",top:"center",show:!1},grid:{top:0,bottom:0,right:0,left:0,containLabel:!0},xAxis:{type:"category",data:this.hours,splitArea:{show:!0}},yAxis:{type:"category",data:this.days,splitArea:{show:!0}},series:{name:"Days with activities played",type:"heatmap",data:[],label:{show:!0},animation:!1,emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}}}ngOnInit(){this.theme.theme.subscribe(e=>{this.overwrite=Object.assign({},this.overwrite,{visualMap:{color:this.getColorArray()}})})}ngOnChanges(e){this.updateActivities(this.activities)}updateActivities(e){const t={},l=new Set;for(const c of e){const o=new Date(Date.parse(c.period)),h=o.getMinutes(),r=o.getSeconds();o.setMinutes(0,0,0);const n=Math.ceil(c.values.activityDurationSeconds.basic.value+60*h+r)/60/60;for(let u=0;u<n;u++){const d=new Date(+o+60*u*60*1e3),y=d.getFullYear()+"-"+d.getMonth()+"-"+d.getDate()+"-"+d.getHours(),A=6-d.getDay();l.has(y)||(l.add(y),t[A]||(t[A]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),t[A][d.getHours()]++)}}let p=0,v=[];for(let c=0;c<7;c++)if(t[c])for(let o=0;o<24;o++){const h=t[c][o];h>0&&(v.push([o,c,h]),h>p&&(p=h))}this.overwrite={visualMap:{color:this.getColorArray(),max:p},series:{data:v}}}getColorArray(){switch(this.theme.currentTheme){case"theme-titan":return["#703636","#d95858"];case"theme-warlock":return["#9a7b39","#e0ca3b"];case"theme-hunter":return["#3a3d67","#4982ce"]}}}return i.\u0275fac=function(e){return new(e||i)(a.Y36(x.f))},i.\u0275cmp=a.Xpm({type:i,selectors:[["app-hour-playtime-heatmap-report"]],inputs:{activities:"activities"},features:[a.TTD],decls:1,vars:2,consts:[["echarts","",1,"demo-chart",3,"options","merge"]],template:function(e,t){1&e&&a._UZ(0,"div",0),2&e&&a.Q6J("options",t.chartOption)("merge",t.overwrite)},dependencies:[f._w],styles:[".demo-chart[_ngcontent-%COMP%]{height:300px}"]}),i})(),B=(()=>{class i{constructor(e){this.theme=e,this.activities=[],this.years=0,this.overwrite={series:[]},this.chartOption={visualMap:{color:["#c52626","#703636","#cea090"],min:0,max:1440,type:"continuous",calculable:!0,formatter:t=>Math.floor(t/60)+"h "+Math.floor(t-60*Math.floor(t/60))+"m",orient:"horizontal",left:"left",top:0},calendar:[],series:[]}}ngOnInit(){this.theme.theme.subscribe(e=>{})}ngOnChanges(e){this.updateActivities(this.activities)}updateActivities(e){const l=e.map(r=>[new Date(Date.parse(r.period)).setHours(0,0,0,0),r.values.timePlayedSeconds.basic.value]).reduce((r,n)=>r.set(n[0],[...r.get(n[0])||[],n]),new Map),p=[];l.forEach((r,n)=>{const u=r.reduce((d,y)=>d+y[1],0)/60;p.push([n,u])});const v=p.reduce((r,n)=>{const u=new Date(n[0]).getFullYear();return r.set(u,[...r.get(u)||[],n])},new Map);var c={},o=Array.from(v.keys());o.sort((r,n)=>r-n),this.years=o.length,c.calendar=[];for(let r=0;r<o.length;r++)c.calendar.push({top:50+90*r,left:0,right:0,itemStyle:{color:"#4f4d4d"},cellSize:["auto",10],range:o[r].toString(),yearLabel:{show:!0,position:"left",formatter:"{start}",margin:20},dayLabel:{margin:5}});const h=[];for(const r of v.keys())h.push({type:"heatmap",coordinateSystem:"calendar",calendarIndex:o.indexOf(r),data:v.get(r)});c.series=h,console.log(c),this.overwrite=c}getColorArray(){switch(this.theme.currentTheme){case"theme-titan":return["#703636","#cea090"];case"theme-warlock":return["#9a7b39","#e0ca3b"];case"theme-hunter":return["#3a3d67","#4982ce"]}}}return i.\u0275fac=function(e){return new(e||i)(a.Y36(x.f))},i.\u0275cmp=a.Xpm({type:i,selectors:[["app-playtime-heatmap-report"]],inputs:{activities:"activities"},features:[a.TTD],decls:1,vars:4,consts:[["echarts","",1,"demo-chart",3,"options","merge"]],template:function(e,t){1&e&&a._UZ(0,"div",0),2&e&&(a.Udp("height",50+90*t.years+"px"),a.Q6J("options",t.chartOption)("merge",t.overwrite))},dependencies:[f._w]}),i})();const J=[{path:"",component:T.$,children:[{path:"",component:(()=>{class i{constructor(e,t,l){this.guardianApi=e,this.toastr=t,this.changeRef=l,this.selectedGuardian=null,this.characters=[],this.totalActivityCount=0,this.activities=[],this.abortSubject=new P.x}ngOnInit(){this.abortSubject.subscribe(()=>{this.activities=[]})}ngOnDestroy(){this.abortSubject.next(null)}selectGuardian(e){var t=this;return(0,M.Z)(function*(){if(t.selectedGuardian=e,t.activities=[],t.abortSubject.next(null),null==e)return;var l=!1;t.abortSubject.subscribe(()=>l=!0);var p=t.toastr.info("Fetching Characters","Loading Data",{progressBar:!0,progressAnimation:"increasing",closeButton:!1,tapToDismiss:!1}),v=yield t.guardianApi.getAllCharacterHistoricalStats(e.membershipType,e.membershipId);if(l)return;t.characters=v,t.totalActivityCount=v.reduce((r,n)=>r+n.merged.allTime.activitiesEntered.basic.value,0),t.toastr.remove(p.toastId);var c=t.toastr.info("Loading Activities","Loading Activities",{progressBar:!0,progressAnimation:"increasing",disableTimeOut:!0,tapToDismiss:!1});let o=[];for(let r=0;r<t.characters.length&&!l;r++){const n=t.characters[r],u=`Characters: ${r+1} of ${t.characters.length}<br/>`,d=t.guardianApi.getCharacterActivities(e.membershipType,e.membershipId,n.characterId,t.abortSubject).pipe((0,w.R)(t.abortSubject),(0,D.b)(y=>{l||(t.activities=o.concat(y),c.toastRef.componentInstance.message=u+`<div>Activities: ${y.length} of ${n.merged.allTime.activitiesEntered.basic.value}</div>`)}),(0,H.Z)());var h=yield(0,R.z)(d);if(l)break;o=o.concat(h),t.activities=o}t.toastr.remove(c.toastId)})()}}return i.\u0275fac=function(e){return new(e||i)(a.Y36(O.J),a.Y36(F._W),a.Y36(a.sBO))},i.\u0275cmp=a.Xpm({type:i,selectors:[["app-playtime-report"]],decls:13,vars:3,consts:[["fxLayout","row","fxLayoutAlign","center none",1,"container"],["fxFlex","95%"],["fxFlex","100%","fxFlex.gt-lg","100%","fxFlex.sm","100%","fxFlex.xs","100%"],[3,"enableLoggedInUser","onGuardianSelection"],[3,"activities"]],template:function(e,t){1&e&&(a.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-card")(4,"app-guardian-selection",3),a.NdJ("onGuardianSelection",function(p){return t.selectGuardian(p)}),a.qZA()()()()(),a.TgZ(5,"div",0)(6,"div",1)(7,"mat-card"),a._UZ(8,"app-playtime-heatmap-report",4),a.qZA()()(),a.TgZ(9,"div",0)(10,"div",1)(11,"mat-card"),a._UZ(12,"app-hour-playtime-heatmap-report",4),a.qZA()()()),2&e&&(a.xp6(4),a.Q6J("enableLoggedInUser",!0),a.xp6(4),a.Q6J("activities",t.activities),a.xp6(4),a.Q6J("activities",t.activities))},dependencies:[g.xw,g.Wh,g.yH,j.a8,I.Q,Z,B],styles:[".demo-chart[_ngcontent-%COMP%]{height:400px;width:100%}"]}),i})()}]}];let G=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=a.oAB({type:i}),i.\u0275inj=a.cJS({imports:[b.Bz.forChild(J),b.Bz]}),i})();var U=s(5823),Y=s(4466),z=s(951);let Q=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=a.oAB({type:i}),i.\u0275inj=a.cJS({imports:[S.ez,Y.m,z.S,G,U.o9,f.Ns.forRoot({echarts:()=>s.e("default-node_modules_echarts_index_js").then(s.bind(s,4734))})]}),i})()}}]);